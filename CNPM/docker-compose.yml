services:
  # Dịch vụ MariaDB Backend
  mariadb:
    image: mariadb:latest
    container_name: mariadb_server
    environment:
      MARIADB_DATABASE: 'timgiasu_db'
      MARIADB_ROOT_PASSWORD: '123456'
    ports:
      # Cổng 3306 của máy host -> 3306 của container
      - '3306:3306'
    volumes:
      - mariadb-data:/var/lib/mysql
    restart: unless-stopped

  # Dịch vụ PHPMYADMIN
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: phpmyadmin_ui
    ports:
      # === ĐÃ THAY ĐỔI ===
      # Cổng 8080 của máy host -> 80 của container
      - '8080:80'
    environment:
      PMA_HOST: mariadb
    depends_on:
      - mariadb
    restart: unless-stopped

  # Dịch vụ Node-RED (API Middleware)
  nodered:
    image: nodered/node-red:latest
    container_name: node_red
    environment:
      TZ: 'Asia/Ho_Chi_Minh'
    ports:
      # Cổng 1880 của máy host -> 1880 của container
      - '1880:1880'
    volumes:
      - nodered-data:/data
    depends_on:
      - mariadb
    restart: unless-stopped

  # Dịch vụ Nginx (Frontend Web Server)
  nginx:
    image: nginx:alpine
    container_name: nginx_frontend
    ports:
      # === ĐÃ THAY ĐỔI ===
      # Cổng 80 của máy host -> 80 của container
      - '8081:80'
      # Cổng 443 (HTTPS) tạm thời bị vô hiệu hóa
      # - '443:443' 
    volumes:
      - ./frontend:/usr/share/frontend:ro
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - nodered
    restart: unless-stopped

# Khai báo volumes
volumes:
  mariadb-data:
  nodered-data: